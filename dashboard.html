<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Hack Tracker</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="assets/js/sessionManager.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap');
        
        /* üëá CSS VARIABLES (Color Palette) */
        :root {
            /* DARK MODE (Default) */
            --bg-color: #050505;
            --text-color: #ffffff;
            --card-bg: rgba(20, 20, 20, 0.7);
            --card-border: #333;
            --navbar-bg: rgba(0,0,0,0.6);
            --input-bg: rgba(20,20,20,0.8);
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --bg-blur: 10px;
            --shadow-color: rgba(0,0,0,0.5);
        }

        /* ‚òÄÔ∏è LIGHT MODE OVERRIDES */
        body.light-mode {
            --bg-color: #f4f6f9;
            --text-color: #333333;
            --card-bg: #ffffff;
            --card-border: #e0e0e0;
            --navbar-bg: rgba(255, 255, 255, 0.9);
            --input-bg: #ffffff;
            --accent-cyan: #007bff; /* Professional Blue */
            --accent-green: #28a745; /* Professional Green */
            --bg-blur: 0px; /* No blur needed */
            --shadow-color: rgba(0,0,0,0.1);
        }

        body { 
            margin: 0; padding: 0; 
            background-color: var(--bg-color); 
            font-family: 'Poppins', sans-serif; 
            color: var(--text-color); 
            display: flex; flex-direction: column; 
            align-items: center; min-height: 100vh; 
            overflow-x: hidden; position: relative;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Canvas (Hidden in Light Mode) */
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at center, #111 0%, #000 100%); transition: opacity 0.5s; }
        body.light-mode #bg-canvas { opacity: 0; pointer-events: none; }

        /* NAVBAR */
        .navbar { 
            display: flex; justify-content: space-between; align-items: center; 
            width: 100%; padding: 20px 40px; box-sizing: border-box; 
            background: var(--navbar-bg); backdrop-filter: blur(var(--bg-blur)); 
            position: fixed; top: 0; left: 0; z-index: 100; border-bottom: 1px solid var(--card-border); 
            transition: 0.3s;
        }
        .nav-left { display: flex; gap: 15px; align-items: center;}

        /* BUTTONS */
        .nav-btn, .team-btn, .auth-btn, .theme-btn { 
            text-decoration: none; padding: 8px 16px; border-radius: 8px; 
            font-family: 'Orbitron', sans-serif; transition: 0.3s; font-size: 14px; 
            cursor: pointer; font-weight: bold; border: 1px solid; background: transparent;
        }
        
        .nav-btn { color: var(--accent-green); border-color: var(--accent-green); } 
        .nav-btn:hover { background: var(--accent-green); color: #000; box-shadow: 0 0 10px var(--accent-green); }

        .team-btn { color: var(--accent-cyan); border-color: var(--accent-cyan); } 
        .team-btn:hover { background: var(--accent-cyan); color: #000; box-shadow: 0 0 10px var(--accent-cyan); }

        .auth-btn { color: #ff4444; border-color: #ff4444; } 
        .auth-btn:hover { background: #ff4444; color: white; box-shadow: 0 0 10px #ff4444; }

        /* üëá THEME TOGGLE BUTTON */
        .theme-btn { color: var(--text-color); border-color: var(--card-border); }
        .theme-btn:hover { background: var(--card-border); }

        .main-content { margin-top: 100px; width: 100%; display: flex; flex-direction: column; align-items: center; }
        h2 { font-family: 'Orbitron', sans-serif; color: var(--accent-cyan); text-shadow: 0 0 10px var(--accent-cyan); font-size: 36px; margin-bottom: 20px; text-transform: uppercase; }
        
        /* ALERT BOX */
        #reminder-container { width: 90%; max-width: 900px; margin-bottom: 20px; display: none; flex-direction: column; gap: 10px; }
        .alert-card { background: rgba(255, 68, 68, 0.1); border: 1px solid #ff4444; border-left: 5px solid #ff4444; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .alert-text { color: #ff6666; font-size: 14px; }
        .alert-title { color: #ff4444; font-weight: bold; font-family: 'Orbitron', sans-serif; margin-right: 10px; }
        .alert-btn { background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: bold; text-decoration: none; }

        /* FILTERS */
        .filter-container { display: flex; gap: 10px; margin-bottom: 30px; width: 90%; max-width: 600px; }
        .search-box, .filter-select { 
            padding: 12px; border-radius: 8px; border: 1px solid var(--card-border); 
            background: var(--input-bg); color: var(--text-color); 
            font-family: 'Poppins', sans-serif; backdrop-filter: blur(5px); flex: 1; 
        }
        .search-box { flex: 2; } 

        .list-container { width: 90%; max-width: 900px; display: grid; grid-template-columns: 1fr; gap: 25px; margin-bottom: 50px; }
        @media(min-width: 768px) { .list-container { grid-template-columns: 1fr 1fr; } }
        
        /* CARD STYLES */
        .hackathon-card { 
            background: var(--card-bg); border: 1px solid var(--card-border); 
            border-top: 5px solid; padding: 30px; border-radius: 15px; 
            transition: 0.3s; position: relative; backdrop-filter: blur(var(--bg-blur));
            box-shadow: 0 5px 15px var(--shadow-color);
        }
        .hackathon-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); border-color: var(--accent-cyan); }
        
        /* Status Colors */
        .status-Winner { border-top-color: #FFD700; } 
        .status-Shortlisted { border-top-color: #bc13fe; } 
        .status-Applied { border-top-color: var(--accent-cyan); } 
        .status-Interested { border-top-color: var(--accent-green); } 
        .status-Rejected { border-top-color: #ff4444; opacity: 0.8; }

        .title { font-size: 20px; font-weight: 800; margin-bottom: 5px; font-family: 'Orbitron', sans-serif; line-height: 1.4; color: var(--text-color); }
        .organizer { font-size: 12px; color: #888; margin-bottom: 15px; display: block; }
        
        .countdown-timer { 
            font-family: 'Orbitron', sans-serif; font-size: 13px; color: #b8860b; /* Dark gold for visibility */
            background: rgba(255, 235, 59, 0.1); padding: 5px 10px; 
            border-radius: 5px; display: inline-block; margin-bottom: 10px; 
            border: 1px solid rgba(255, 235, 59, 0.5); 
        }
        body:not(.light-mode) .countdown-timer { color: #ffeb3b; border-color: rgba(255, 235, 59, 0.3); }

        .date-highlight { font-size: 13px; font-weight: bold; color: #888; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; color: var(--text-color); opacity: 0.8; }
        
        .badge { font-size: 10px; padding: 4px 8px; border-radius: 5px; background: #222; border: 1px solid #444; color: #fff; }
        .status-badge { font-size: 10px; padding: 4px 8px; border-radius: 5px; background: #333; color: #fff; border: 1px solid #555; font-weight: bold; }

        .team-section { background: rgba(0,0,0,0.05); padding: 10px; border-radius: 8px; margin-top: 15px; border: 1px dashed var(--card-border); }
        .team-status { font-size: 12px; font-weight: bold; margin-bottom: 5px; display: block; }
        .status-full { color: #ff4444; } .status-open { color: var(--accent-green); }
        .member-list { font-size: 11px; color: var(--text-color); font-style: italic; opacity: 0.7; }
        
        .proof-btn, .calendar-btn { background: transparent; border: 1px solid var(--accent-cyan); color: var(--accent-cyan); padding: 6px 10px; border-radius: 6px; text-decoration: none; font-size: 10px; font-family: 'Poppins'; display: inline-flex; align-items: center; gap: 5px; transition: 0.3s; }
        .proof-btn:hover { background: var(--accent-cyan); color: #fff; }
        .calendar-btn { border-color: #ffc107; color: #ffc107; } .calendar-btn:hover { background: #ffc107; color: #000; }

        .btn-group { display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap; }
        .visit-btn { flex: 1; text-align: center; background: #333; color: #fff; padding: 8px 0; border-radius: 8px; text-decoration: none; font-weight: bold; font-family: 'Orbitron', sans-serif; font-size: 11px; border: 1px solid #555; transition: 0.3s; }
        .visit-btn:hover { background: #fff; color: #000; }
        .report-btn { background: #fff; color: #000; border: none; font-weight: 800; } 
        body.light-mode .report-btn { background: #333; color: #fff; }

        .action-btn { background: #222; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 14px; }
        .edit-btn:hover { background: #ffeb3b; color: #000; border-color: #ffeb3b; } .delete-btn:hover { background: #ff4444; color: white; border-color: #ff4444; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal { background: var(--card-bg); padding: 30px; border-radius: 15px; border: 1px solid var(--accent-green); width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; color: var(--text-color); }
        .modal input, .modal select { width: 100%; padding: 10px; margin-bottom: 10px; background: var(--input-bg); border: 1px solid var(--card-border); color: var(--text-color); border-radius: 5px; box-sizing: border-box; }
        .modal-actions { display: flex; gap: 10px; margin-top: 10px; }
        .save-btn { flex: 1; background: var(--accent-green); border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .cancel-btn { flex: 1; background: #333; color: #fff; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        
        .footer { margin-top: 20px; font-size: 12px; color: #888; font-family: 'Orbitron', sans-serif; padding-bottom: 20px; }
        .footer span { color: var(--accent-green); font-weight: bold; }

        /* Media Queries */
        @media (max-width: 768px) { .navbar { padding: 12px 15px; } .nav-left { display: none; } .hamburger { display: flex; margin-left: auto; margin-right: 10px; color: var(--accent-green); border: none; background: none; font-size: 24px; cursor: pointer;} .filter-container { width: 95%; } .list-container { width: 95%; grid-template-columns: 1fr; } }
        
        /* Loading */
        .loading-container { text-align: center; margin-top: 50px; }
        .spinner { border: 3px solid rgba(0, 255, 136, 0.2); border-top: 3px solid var(--accent-green); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <div class="navbar">
        <div class="nav-left">
            <a href="javascript:void(0)" onclick="goToAdd()" class="nav-btn"><i class="fas fa-plus"></i> ADD EVENT</a>
            <a href="team.html" class="team-btn"><i class="fas fa-users"></i> TEAM</a>
        </div>
        
        <div style="display:flex; gap:10px; align-items:center; margin-left: auto;">
            <button onclick="toggleTheme()" class="theme-btn" id="themeBtn">‚òÄÔ∏è</button>
            
            <button onclick="logout()" class="auth-btn"><i class="fas fa-sign-out-alt"></i> LOGOUT</button>
        </div>
        
        </div>

    <div class="main-content">
        <h2><i class="fas fa-rocket"></i> UPCOMING EVENTS</h2>
        
        <div id="reminder-container"></div>

        <div class="filter-container">
            <input type="text" id="search-input" class="search-box" placeholder="üîé Search Hackathon..." oninput="filterHackathons()">
            <select id="mode-filter" class="filter-select" onchange="filterHackathons()">
                <option value="All">All Modes</option><option value="Online">Online</option><option value="Offline">Offline</option><option value="Hybrid">Hybrid</option>
            </select>
        </div>

        <div class="list-container" id="hackList">
            <div class="loading-container"><div class="spinner"></div><p style="margin-top:10px;">Loading Data...</p></div>
        </div>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <h3><i class="fas fa-edit"></i> EDIT DETAILS</h3>
            <input type="hidden" id="edit-id">
            <label style="font-size:12px;">Event Name</label><input type="text" id="edit-name">
            <label style="font-size:12px;">Start Date</label><input type="date" id="edit-date">
            <label style="font-size:12px;">End Date</label><input type="date" id="edit-end-date">
            <label style="font-size:12px;">Team Members</label><input type="text" id="edit-members">
            <label style="font-size:12px;">Registered? ‚úÖ</label><select id="edit-reg"><option value="Yes">Yes</option><option value="No">No</option></select>
            <label style="font-size:12px;">Current Status üö¶</label>
            <select id="edit-status">
                <option value="Interested">Interested</option><option value="Applied">Applied</option><option value="Shortlisted">Shortlisted</option><option value="Rejected">Rejected</option><option value="Winner">Winner üèÜ</option>
            </select>
            <label style="font-size:12px; color:var(--accent-cyan)">Certificate Link</label><input type="url" id="edit-cert" placeholder="Link">
            <label style="font-size:12px; color:var(--accent-cyan)">Photos Link</label><input type="url" id="edit-photos" placeholder="Link">
            <div class="modal-actions"><button class="save-btn" onclick="saveEdit()">SAVE</button><button class="cancel-btn" onclick="closeModal()">CANCEL</button></div>
        </div>
    </div>

    <div class="footer">Made by <span>BitRise</span> üöÄ</div>

    <script>
        const API_URL = (window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost") ? "http://localhost:5000/api/hackathons" : "https://hackathontracker.onrender.com/api/hackathons";
        const listDiv = document.getElementById('hackList');
        const modal = document.getElementById('editModal');
        const isLoggedIn = localStorage.getItem("isTeamMember") === "true";
        let allHackathons = [];

        // --- üëá THEME TOGGLE LOGIC ---
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('themeBtn');
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                btn.innerHTML = "üåô"; // Switch to Moon icon
                localStorage.setItem('theme', 'light');
            } else {
                btn.innerHTML = "‚òÄÔ∏è"; // Switch to Sun icon
                localStorage.setItem('theme', 'dark');
            }
        }

        // Apply saved theme on load
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
            document.getElementById('themeBtn').innerHTML = "üåô";
        }

        function goToAdd() { if (isLoggedIn) window.location.href = "index.html"; else window.location.href = "login.html"; }
        function logout() { localStorage.removeItem("isTeamMember"); window.location.href = "login.html"; }

        // --- ANIMATION SCRIPT ---
        const canvas = document.getElementById('bg-canvas'); const ctx = canvas.getContext('2d'); let width, height;
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; } window.addEventListener('resize', resize); resize();
        const particles = []; const particleCount = 50; 
        class Particle { constructor() { this.reset(); } reset() { this.x = Math.random() * width; this.y = Math.random() * height; this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5; this.size = Math.random() * 2; this.color = Math.random() > 0.5 ? '#00ff88' : '#00d4ff'; } update() { this.x += this.vx; this.y += this.vy; if (this.x < 0 || this.x > width) this.vx *= -1; if (this.y < 0 || this.y > height) this.vy *= -1; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); } }
        for (let i = 0; i < particleCount; i++) { particles.push(new Particle()); }
        function animate() { ctx.clearRect(0, 0, width, height); ctx.lineWidth = 0.5; for (let i = 0; i < particleCount; i++) { let p1 = particles[i]; p1.update(); p1.draw(); for (let j = i + 1; j < particleCount; j++) { let p2 = particles[j]; let dx = p1.x - p2.x; let dy = p1.y - p2.y; let dist = Math.sqrt(dx*dx + dy*dy); if (dist < 120) { ctx.beginPath(); ctx.strokeStyle = `rgba(0, 255, 136, ${1 - dist/120})`; ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); } } } requestAnimationFrame(animate); } animate();

        function triggerConfetti() {
            var duration = 3000; var animationEnd = Date.now() + duration; var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            var interval = setInterval(function() { var timeLeft = animationEnd - Date.now(); if (timeLeft <= 0) return clearInterval(interval); var particleCount = 50 * (timeLeft / duration); confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } })); confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } })); }, 250);
        }

        // --- HELPER: CALENDAR LINK ---
        function generateCalendarLink(name, start, end, location) {
            const s = start.replace(/-/g, '');
            const e = end.replace(/-/g, '');
            return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(name)}&dates=${s}/${e}&details=Hackathon+Event&location=${encodeURIComponent(location)}`;
        }

        // --- HELPER: CHECK ALERTS ---
        function checkReminders(data) {
            const container = document.getElementById('reminder-container');
            container.innerHTML = "";
            let hasAlerts = false;
            const today = new Date();
            
            data.forEach(hack => {
                const eventDate = new Date(hack.startDate);
                const diffTime = eventDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays >= 0 && diffDays <= 7) {
                    hasAlerts = true;
                    container.style.display = "flex";
                    const calLink = generateCalendarLink(hack.name, hack.startDate, hack.endDate, hack.location);
                    container.innerHTML += `
                        <div class="alert-card">
                            <div>
                                <span class="alert-title"><i class="fas fa-exclamation-triangle"></i> ALERT:</span>
                                <span class="alert-text"><strong>${hack.name}</strong> starts in <strong>${diffDays} days!</strong> (${hack.startDate})</span>
                            </div>
                            <a href="${calLink}" target="_blank" class="alert-btn"><i class="fas fa-calendar-plus"></i> Remind Me</a>
                        </div>`;
                }
            });
            if(!hasAlerts) container.style.display = "none";
        }

        async function loadHackathons() {
            try {
                const res = await fetch(API_URL); let data = await res.json();
                data.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                allHackathons = data;
                checkReminders(allHackathons); 
                renderList(allHackathons);
            } catch (err) { console.error(err); listDiv.innerHTML = "<p style='color:red; text-align:center;'>Server Error!</p>"; }
        }

        function filterHackathons() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const mode = document.getElementById('mode-filter').value;
            const filteredData = allHackathons.filter(hack => {
                const matchesName = hack.name.toLowerCase().includes(query);
                const matchesMode = mode === "All" || hack.mode === mode;
                return matchesName && matchesMode;
            });
            renderList(filteredData);
        }

        function renderList(data) {
            listDiv.innerHTML = "";
            if (data.length === 0) { listDiv.innerHTML = "<p style='text-align:center; opacity:0.6;'>No match found.</p>"; return; }

            data.forEach(hack => {
                const pptClass = hack.pptNeeded === 'Yes' ? 'yes' : 'no';
                const regClass = hack.registered === 'Yes' ? 'yes' : 'no';
                const currentStatus = hack.currentStatus || 'Interested'; const statusClass = `status-${currentStatus}`;
                let membersList = hack.teamMembers ? hack.teamMembers.split(',').map(s => s.trim()).filter(s => s) : [];
                let vacancy = hack.teamSize - membersList.length;
                let statusText = vacancy > 0 ? `<i class="fas fa-check-circle" style="color:var(--accent-green)"></i> ${vacancy} Slot(s) Open` : `<i class="fas fa-times-circle" style="color:#ff4444"></i> Team Full`;
                let statusColorClass = vacancy > 0 ? 'status-open' : 'status-full';

                const adminButtons = isLoggedIn ? `
                    <button class="action-btn edit-btn" onclick="openEdit('${hack._id}', '${hack.name}', '${hack.startDate}', '${hack.endDate}', '${hack.registered}', '${currentStatus}', '${hack.teamMembers || ''}', '${hack.certificate || ''}', '${hack.photos || ''}')"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn delete-btn" onclick="deleteHack('${hack._id}')"><i class="fas fa-trash-alt"></i></button>` : '';

                const certBtn = hack.certificate ? `<a href="${hack.certificate}" target="_blank" class="proof-btn"><i class="fas fa-certificate"></i> Cert</a>` : '';
                const photoBtn = hack.photos ? `<a href="${hack.photos}" target="_blank" class="proof-btn"><i class="fas fa-images"></i> Photos</a>` : '';
                const calLink = generateCalendarLink(hack.name, hack.startDate, hack.endDate, hack.location);

                const card = `
                    <div class="hackathon-card ${statusClass}">
                        <div class="title">${hack.name}</div>
                        <div class="countdown-timer" id="timer-${hack._id}" data-date="${hack.startDate}">Loading...</div>
                        <div class="date-highlight"><i class="fas fa-calendar"></i> ${hack.startDate} <span style="font-size:12px; opacity:0.7; margin:0 5px;">to</span> ${hack.endDate}</div>
                        <span class="organizer">By ${hack.organizer}</span>
                        <div class="info-row"><span><i class="fas fa-map-marker-alt"></i> ${hack.location} (${hack.mode})</span></div>
                        <div style="margin-top: 10px; display:flex; gap:5px;">
                            <span class="badge ${pptClass}">PPT: ${hack.pptNeeded}</span>
                            <span class="badge ${regClass}">Reg: ${hack.registered}</span>
                            <span class="status-badge"><i class="fas fa-traffic-light"></i> ${currentStatus}</span>
                        </div>
                        <div class="team-section">
                            <span class="team-status ${statusColorClass}">${statusText} (${membersList.length}/${hack.teamSize})</span>
                            <div class="member-list">${membersList.length > 0 ? membersList.join(', ') : 'No members yet'}</div>
                        </div>
                        <div style="margin-top:10px; display:flex; gap:5px; flex-wrap:wrap;">
                            ${certBtn} ${photoBtn}
                            <a href="${calLink}" target="_blank" class="calendar-btn"><i class="fas fa-calendar-plus"></i> Remind Me</a>
                        </div>
                        <div class="btn-group">
                            <a href="${hack.link}" target="_blank" class="visit-btn">VISIT LINK ‚Üó</a>
                            <a href="report.html?id=${hack._id}" target="_blank" class="visit-btn report-btn"><i class="fas fa-file-alt"></i> REPORT</a>
                            ${adminButtons}
                        </div>
                    </div>`;
                listDiv.innerHTML += card;
            });
            startCountdown();
        }

        function startCountdown() { setInterval(() => { const timers = document.querySelectorAll('.countdown-timer'); timers.forEach(timer => { const eventDate = new Date(timer.getAttribute('data-date')).getTime(); const now = new Date().getTime(); const distance = eventDate - now; if (distance < 0) { timer.innerHTML = `<i class="fas fa-times-circle"></i> EVENT STARTED`; timer.style.color = "#ff4444"; timer.style.borderColor = "#ff4444"; } else { const days = Math.floor(distance / (1000 * 60 * 60 * 24)); const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)); const seconds = Math.floor((distance % (1000 * 60)) / 1000); timer.innerHTML = `<i class="fas fa-hourglass-end" style="margin-right:5px;"></i>${days}d ${hours}h ${minutes}m ${seconds}s`; } }); }, 1000); }
        async function deleteHack(id) { if(!confirm("Delete this?")) return; await fetch(`${API_URL}/${id}`, { method: 'DELETE' }); loadHackathons(); }
        function openEdit(id, name, date, endDate, reg, status, members, cert, photos) { document.getElementById('edit-id').value = id; document.getElementById('edit-name').value = name; document.getElementById('edit-date').value = date; document.getElementById('edit-end-date').value = endDate; document.getElementById('edit-members').value = members; document.getElementById('edit-reg').value = reg; document.getElementById('edit-status').value = status; document.getElementById('edit-cert').value = cert; document.getElementById('edit-photos').value = photos; modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }
        async function saveEdit() { const id = document.getElementById('edit-id').value; const status = document.getElementById('edit-status').value; if (status === "Winner") triggerConfetti(); const updatedData = { name: document.getElementById('edit-name').value, startDate: document.getElementById('edit-date').value, endDate: document.getElementById('edit-end-date').value, teamMembers: document.getElementById('edit-members').value, registered: document.getElementById('edit-reg').value, currentStatus: status, certificate: document.getElementById('edit-cert').value, photos: document.getElementById('edit-photos').value }; await fetch(`${API_URL}/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(updatedData) }); closeModal(); loadHackathons(); }
        loadHackathons();
    </script>
</body>
</html>